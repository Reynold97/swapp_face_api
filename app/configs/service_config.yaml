name: SwapFaceAPI-Service

applications:
- name: SwapFaceAPI
  route_prefix: /
  import_path: app.api.main:app
  runtime_env: {}  

  deployments:

  - name: APIIngress
    num_replicas: 1
    ray_actor_options:
      num_cpus: 0.25
      num_gpus: 0
  - name: FaceAnalyzer
    num_replicas: 1
    ray_actor_options:
      num_cpus: 0.25
      num_gpus: 0.1
  - name: FaceSwapper
    num_replicas: 1
    ray_actor_options:
      num_cpus: 0.25
      num_gpus: 0.1
  - name: FaceEnhancer
    num_replicas: 1
    ray_actor_options:
      num_cpus: 0.25
      num_gpus: 0.1
  - name: GCPImageManager
    num_replicas: 1
    ray_actor_options:
      num_cpus: 0.25
      num_gpus: 0
    init_args:
          - app/configs/gcp_gcs_config.json
          - anyscale_tmp_faces

compute_config:
  head_node:
  instance_type: e2-standard-4

  worker_nodes:
  - instance_type: g2-standard-8-nvidia-l4-1
    min_nodes: 0
    max_nodes: 5
    market_type: PREFER_SPOT # (Optional) Defaults to ON_DEMAND

  enable_cross_zone_scaling: true # (Optional) Defaults to false.
  
excludes: # (Optional) List of files to exclude from being packaged up for the job.
  - .git
  - .env
  - .DS_Store
  - __pycache__
  - app/configs/api.json

query_auth_token_enabled: True # (Optional) Whether or not to gate this service behind an auth token.

http_options:
  port: 8000
  request_timeout_s: 60 # (Optional) Timeout for HTTP requests in seconds. Default is no timeout.
  keep_alive_timeout_s: 60 # (Optional) Timeout for HTTP keep-alive connections in seconds. Default is 5 seconds.

logging_config: # (Optional) Configuration options for logging.
  encoding: JSON # JSON or TEXT.
  log_level: INFO
  enable_access_log: true

ray_gcs_external_storage_config:
  enabled: false
